<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>雙月日期選擇器 - 響應式版</title>
    <style>
      body {
        font-family: "Microsoft JhengHei", sans-serif;
        padding: 20px; /* 手機版減少 padding */
        background: #f9f9f9;
      }
      .date-wrap {
        position: relative;
        width: 100%; /* 手機版預設全寬 */
        max-width: 350px; /* 電腦版限制最大寬度 */
      }
      input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
        box-sizing: border-box;
        background: #fff;
      }

      /* 月曆主容器 */
      .calendar {
        position: absolute;
        top: 55px;
        left: 0;
        display: none;
        background: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        padding: 15px;
        z-index: 999;
        border-radius: 8px;
        box-sizing: border-box;
      }

      /* 月份容器佈局 */
      .month-container {
        display: flex;
        flex-direction: row; /* 電腦版橫向 */
        gap: 20px;
      }

      /* --- 響應式設定 --- */
      @media (min-width: 768px) {
        .calendar {
          width: 600px; /* 電腦版寬度 */
        }
      }

      @media (max-width: 767px) {
        body {
          padding: 10px;
        }
        .calendar {
          width: calc(100vw - 20px); /* 手機版佔滿螢幕寬度，扣除 margin */
          left: 0;
          position: fixed; /* 手機版建議固定，避免被遮擋 */
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%); /* 居中彈出 */
          max-height: 90vh;
          overflow-y: auto;
        }
        .month-container {
          flex-direction: column; /* 手機版改為上下堆疊 */
          gap: 15px;
        }
        td {
          height: 40px; /* 手機版稍微縮小格子高度 */
        }
      }

      .month-box {
        flex: 1;
      }
      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        font-weight: bold;
      }
      .nav button {
        background: #f0f0f0;
        border: none;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 4px;
      }
      .nav button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }
      th {
        color: #ff625d;
        font-size: 13px;
        padding-bottom: 10px;
      }
      td {
        height: 45px;
        text-align: center;
        cursor: pointer;
        position: relative;
        font-size: 14px;
      }
      td.disabled {
        color: #ccc !important;
        cursor: default;
      }

      /* 顏色樣式維持原狀 */
      td.start-date,
      td.end-date,
      td.hover-end {
        background: #ff625d !important;
        color: #fff !important;
        z-index: 2;
      }
      td.start-date {
        border-radius: 6px 0 0 6px;
      }
      td.end-date,
      td.hover-end {
        border-radius: 0 6px 6px 0;
      }
      td.only-one {
        border-radius: 6px !important;
      }

      td.in-range::before,
      td.hover-range::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 98, 93, 0.15);
        z-index: 0;
      }

      .date-box {
        position: relative;
        z-index: 3;
        display: flex;
        flex-direction: column;
      }
      .txt {
        font-size: 10px;
        height: 12px;
        margin-top: 2px;
      }
      .status-hint {
        color: #666;
        font-size: 12px;
        margin-bottom: 10px;
        height: 18px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h3>航班預約 (響應式設計)</h3>
    <div class="date-wrap">
      <input type="text" id="dateInput" placeholder="請選擇日期區間" readonly />
      <div class="calendar" id="calendar">
        <div id="statusHint" class="status-hint"></div>
        <div class="month-container">
          <div class="month-box">
            <div class="nav">
              <button id="prevBtn">❮</button>
              <span id="title1"></span>
              <span></span>
            </div>
            <div id="table1"></div>
          </div>
          <div class="month-box">
            <div class="nav">
              <span></span> <span id="title2"></span>
              <button id="nextBtn">❯</button>
            </div>
            <div id="table2"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // JavaScript 部分保持您的邏輯不變，僅微調自動關閉效果
      const input = document.getElementById("dateInput");
      const calendar = document.getElementById("calendar");
      const statusHint = document.getElementById("statusHint");
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      let startDate = new Date(2026, 0, 16);
      let endDate = new Date(2026, 1, 3);
      let viewDate = new Date(2026, 0, 1);

      function render() {
        const m1 = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1);
        const m2 = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1);
        document.getElementById(
          "title1"
        ).textContent = `${m1.getFullYear()}年 ${m1.getMonth() + 1}月`;
        document.getElementById(
          "title2"
        ).textContent = `${m2.getFullYear()}年 ${m2.getMonth() + 1}月`;
        document.getElementById("table1").innerHTML = createTable(m1);
        document.getElementById("table2").innerHTML = createTable(m2);
        document.getElementById("prevBtn").disabled =
          m1 <= new Date(today.getFullYear(), today.getMonth(), 1);

        updateUI();
        attachEvents();
      }

      function createTable(monthDate) {
        const y = monthDate.getFullYear(),
          m = monthDate.getMonth();
        const firstDay = new Date(y, m, 1).getDay();
        const lastDate = new Date(y, m + 1, 0).getDate();
        let html =
          "<table><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr><tr>";
        for (let i = 0; i < firstDay; i++) html += "<td></td>";
        for (let d = 1; d <= lastDate; d++) {
          const curr = new Date(y, m, d);
          const dateStr = `${y}-${m + 1}-${d}`;
          html += `<td data-date="${dateStr}" class="${
            curr < today ? "disabled" : ""
          }">
                      <div class="date-box"><span>${d}</span><span class="txt"></span></div>
                    </td>`;
          if ((firstDay + d) % 7 === 0) html += "</tr><tr>";
        }
        return html + "</tr></table>";
      }

      function updateUI() {
        document.querySelectorAll("td[data-date]").forEach((td) => {
          const curr = new Date(td.dataset.date.replace(/-/g, "/"));
          const txt = td.querySelector(".txt");
          td.classList.remove(
            "start-date",
            "end-date",
            "in-range",
            "only-one",
            "hover-range",
            "hover-end"
          );
          txt.textContent = "";

          if (startDate && curr.getTime() === startDate.getTime()) {
            td.classList.add("start-date");
            txt.textContent = "出發";
            if (!endDate) td.classList.add("only-one");
          }
          if (endDate && curr.getTime() === endDate.getTime()) {
            td.classList.add("end-date");
            txt.textContent = "抵達";
            if (!startDate) td.classList.add("only-one");
          }
          if (startDate && endDate && curr > startDate && curr < endDate) {
            td.classList.add("in-range");
          }
        });

        if (!startDate) statusHint.textContent = "請選擇 [出發日期]";
        else if (!endDate) statusHint.textContent = "請選擇 [抵達日期]";
        else statusHint.textContent = "點擊日期可修改區間";
      }

      function attachEvents() {
        document.querySelectorAll("td[data-date]").forEach((td) => {
          if (td.classList.contains("disabled")) return;

          td.onclick = () => {
            const clicked = new Date(td.dataset.date.replace(/-/g, "/"));
            if (startDate && clicked.getTime() === startDate.getTime()) {
              startDate = null;
            } else if (endDate && clicked.getTime() === endDate.getTime()) {
              endDate = null;
            } else if (!startDate) {
              if (endDate && clicked >= endDate) return;
              startDate = clicked;
            } else if (startDate && !endDate) {
              if (clicked <= startDate) {
                startDate = clicked;
              } else {
                endDate = clicked;
                setTimeout(() => {
                  calendar.style.display = "none";
                }, 500);
              }
            } else {
              startDate = clicked;
              endDate = null;
            }
            updateInput();
            updateUI();
          };

          td.onmouseenter = () => {
            if (!startDate || endDate) return;
            const hoverDate = new Date(td.dataset.date.replace(/-/g, "/"));
            if (hoverDate <= startDate) return;
            document.querySelectorAll("td[data-date]").forEach((t) => {
              const c = new Date(t.dataset.date.replace(/-/g, "/"));
              t.classList.remove("hover-range", "hover-end");
              if (c > startDate && c < hoverDate)
                t.classList.add("hover-range");
              if (c.getTime() === hoverDate.getTime()) {
                t.classList.add("hover-end");
                t.querySelector(".txt").textContent = "抵達";
              }
            });
          };
          td.onmouseleave = () => {
            if (!endDate) updateUI();
          };
        });
      }

      function updateInput() {
        const fmt = (d) =>
          d
            ? `${d.getFullYear()}/${(d.getMonth() + 1)
                .toString()
                .padStart(2, "0")}/${d.getDate().toString().padStart(2, "0")}`
            : "";
        input.value =
          startDate || endDate ? `${fmt(startDate)} ~ ${fmt(endDate)}` : "";
      }

      input.onclick = (e) => {
        e.stopPropagation();
        calendar.style.display = "block";
        render();
      };
      document.getElementById("prevBtn").onclick = (e) => {
        e.stopPropagation();
        viewDate.setMonth(viewDate.getMonth() - 1);
        render();
      };
      document.getElementById("nextBtn").onclick = (e) => {
        e.stopPropagation();
        viewDate.setMonth(viewDate.getMonth() + 1);
        render();
      };
      document.onclick = (e) => {
        if (!e.target.closest(".date-wrap") && !e.target.closest(".calendar"))
          calendar.style.display = "none";
      };

      updateInput();
    </script>
  </body>
</html>
